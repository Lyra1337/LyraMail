@page "/inbox"
@inherits MailboxPageViewModel

<PageTitle Title="Mailbox" />

<span>your email address:</span>

@if (this.UserState.CurrentMailbox != null)
{
    <input readonly class="form-control" type="text" @bind-value="this.UserState.CurrentMailbox" />
}

<button @onclick="this.Refresh" role="button" class="btn btn-secondary">Refresh</button>
<button @onclick="this.GetNewMailbox" role="button" class="btn btn-danger">New Address</button>
<button @onclick="this.TestEmail" role="button" class="btn btn-primary">Test Email</button>

<div class="row no-gutters">
    <div class="col-sm-6 col-md-5 col-lg-4">
        <div class="list-group">
            @foreach (var mail in this.Mails)
            {
                <a href="javascript:void(0)"
                   @onclick="() => this.ShowMail(mail)"
                   class="list-group-item list-group-item-action flex-column align-items-start @(this.CurrentMail == mail ? "active" : "")">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1">
                            @mail.FromAddress
                        </h5>
                        <small>@mail.ReceivedDate.ToShortTimeString()</small>
                    </div>
                    <strong>
                        @mail.Subject
                    </strong>
                    <p class="my-1">
                        @mail.BodyText
                    </p>
                </a>
            }
        </div>
    </div>
    <div class="col-sm-6 col-md-7 col-lg-8">
        @if (this.CurrentMail != null)
        {
            <Card>
                <Title>
                    @this.CurrentMail.Subject
                </Title>
                <Body>
                    @if (String.IsNullOrWhiteSpace(this.CurrentMail.BodyHtml) == false)
                    {
                        <iframe src="/Api/HtmlContent/@(Uri.EscapeDataString(this.UserState.CurrentMailbox))/@(this.CurrentMail.Secret)"
                                sandbox class="w-100" style="border: 0;"></iframe>
                    }
                    else
                    {
<pre class="text-break">
@this.CurrentMail.BodyText
</pre>
                    }
                </Body>
            </Card>
        }
    </div>
</div>